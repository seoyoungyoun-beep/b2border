<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>[빈브라더스] 도매 파트너 주문서</title>
  <style>
    :root { --gap: 12px; --radius: 12px; }
    body {
      font-family: system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Helvetica,Arial,sans-serif;
      margin: 0; background:#fafafa; color:#111;
    }
    .container { max-width: 720px; margin: 24px auto; padding: 24px;
      background:#fff; border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,.06);}
    h1 { margin:0 0 8px; font-size:22px }
    .sub { color:#444; margin-bottom:20px; white-space:pre-line; font-size:14px; line-height:1.6 }
    label { font-size:14px; color:#333; display:block; margin:14px 0 6px }
    input, select {
      padding: 12px 14px; border:1px solid #ddd; border-radius:var(--radius);
      font-size:15px; box-sizing:border-box;
    }
    input.text-short { max-width:300px; width:100%; }
    input[type="number"] { text-align:right }
    .table-wrap { width:100%; overflow-x:auto; -webkit-overflow-scrolling:touch; }
    table { width:100%; border-collapse:collapse; min-width:540px; table-layout: fixed; }
    th, td { padding:10px; border-bottom:1px solid #eee; text-align:left;
      font-size:14px; vertical-align:middle }
    th { background:#fafafa; font-weight:600 }
    #itemsTable th:nth-child(4), #itemsTable td:nth-child(4){ text-align:center; width:84px }
    .btn { appearance:none; border:none; border-radius:var(--radius);
      padding:12px 16px; cursor:pointer; font-weight:600; font-size:15px }
    .btn-primary { background:#111; color:#fff }
    .btn-secondary { background:#f1f3f5; color:#111 }
    .btn-danger { background:#ffe3e3; color:#c92a2a; padding:8px 12px }
    .row-actions { display:flex; gap:var(--gap); align-items:center; justify-content:space-between; margin-top:14px }
    .success,.error{padding:12px 14px;border-radius:var(--radius);margin-top:12px;font-size:14px;line-height:1.5}
    .success{background:#e6fcf5;color:#087f5b}
    .error{background:#fff5f5;color:#c92a2a}
    @media (max-width:640px){
      .container{margin:12px auto; padding:16px}
      h1{font-size:20px}
      .btn{width:100%}
      .row-actions{flex-direction:column;align-items:stretch}
      input,select{font-size:16px}
      /* 테이블 컬럼 비율 */
      #itemsTable th:nth-child(1), #itemsTable td:nth-child(1){ width:46%; }
      #itemsTable th:nth-child(2), #itemsTable td:nth-child(2){ width:24%; }
      #itemsTable th:nth-child(3), #itemsTable td:nth-child(3){ width:22%; }
      #itemsTable th:nth-child(4), #itemsTable td:nth-child(4){ width:8%; text-align:center; }
      /* 수량 입력칸, 삭제버튼 작게 */
      #itemsTable input[type="number"]{ width:68px !important; min-width:68px; max-width:68px; }
      .btn-danger{ padding:6px 8px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>[빈브라더스] 도매 파트너 주문서</h1>
    <div class="sub">- 평일 오전 10시까지 주문시 당일 출고됩니다. 나머지 주문 건들은 익일 출고됩니다.
- 긴급 출고 요청 시, 카톡문의 혹은 전화 주세요. (010 8767 4709)</div>

    <label for="company">매장 이름</label>
    <input id="company" class="text-short" placeholder="예) 강남점 / 홍대점" />

    <label>주문 품목</label>
    <div class="table-wrap">
      <table id="itemsTable">
        <thead>
          <tr><th>제품명</th><th>규격</th><th>수량</th><th>삭제</th></tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div class="row-actions">
      <button id="addRow" class="btn btn-secondary">+ 품목 추가</button>
      <span id="totalQtyText">총 수량: 0개</span>
    </div>

    <label for="phone">연락처</label>
    <input id="phone" class="text-short" type="tel" inputmode="tel" placeholder="010-1234-5678" />

    <div style="margin-top:12px">
      <button id="submitBtn" class="btn btn-primary">주문 제출</button>
    </div>

    <div id="msg"></div>
  </div>

<script>
const ITEMS = [
  "[원두] 블랙수트_1kg","[원두] 벨벳화이트_1kg","[원두] 세븐티_1kg",
  "[원두] 몰트_1kg","[원두] 매트_1kg",
  "[원두] 디카페인_ 미디엄로스트_1kg","[원두] 디카페인_ 다크 로스트_1kg",
  "[콜드브루] 블랙수트(고농도)_1L","[콜드브루] 블랙수트(중농도)_500ml",
  "[콜드브루] 디카페인(고농도)_1L","[콜드브루] 벨벳화이트(중농도)_500ml",
  "[콜드브루] 디카페인(중농도)_500ml","[콜드브루] 블랙수트 RTD_235ml",
  "[기타] 싱글 오리진_(제품명 변경)"
];
const SIZES = ["1kg","1L","500ml","235ml"];
const SINGLE_SIZES = ["200g","1kg"];
const WEB_APP_URL = "YOUR_APPS_SCRIPT_WEB_APP_URL"; // 붙여넣기

const tbody=document.getElementById('tbody');
const addRowBtn=document.getElementById('addRow');
const submitBtn=document.getElementById('submitBtn');
const totalQtyText=document.getElementById('totalQtyText');

function makeSelect(opts){const s=document.createElement('select');
  opts.forEach(o=>{const op=document.createElement('option');op.value=o;op.textContent=o;s.appendChild(op)});return s;}

function addRow(){
  const tr=document.createElement('tr');
  const tdItem=document.createElement('td');
  const selItem=makeSelect(ITEMS);
  const custom=document.createElement('input');
  custom.placeholder='싱글 오리진 제품명'; custom.style.display='none'; custom.style.marginTop='6px';
  tdItem.appendChild(selItem); tdItem.appendChild(custom);
  const tdSize=document.createElement('td');
  const selSize=makeSelect(SIZES); selSize.disabled=true; tdSize.appendChild(selSize);
  const tdQty=document.createElement('td');
  const qty=document.createElement('input'); qty.type='number'; qty.min='1'; qty.placeholder='0';
  qty.addEventListener('input',updateTotal); tdQty.appendChild(qty);
  const tdDel=document.createElement('td');
  const del=document.createElement('button'); del.textContent='삭제'; del.className='btn btn-danger';
  del.onclick=()=>{tr.remove();updateTotal()}; tdDel.appendChild(del);
  tr.append(tdItem,tdSize,tdQty,tdDel); tbody.appendChild(tr);
  function inferSize(v){const m=v.match(/_(\\d+(?:kg|ml|L))$/)||v.match(/(\\d+(?:kg|ml|L))$/);return m?m[1]:''}
  function handleChange(){
    if(selItem.value.includes('싱글 오리진')){custom.style.display='block';tdSize.innerHTML='';tdSize.appendChild(makeSelect(SINGLE_SIZES))}
    else{custom.style.display='none';tdSize.innerHTML='';const sizeSel=makeSelect(SIZES);
      const s=inferSize(selItem.value);if(s) sizeSel.value=s; sizeSel.disabled=true;tdSize.appendChild(sizeSel)}
  }
  selItem.addEventListener('change',handleChange);handleChange();updateTotal();
}
function updateTotal(){let t=0;[...tbody.querySelectorAll('input[type=number]')].forEach(i=>{const v=parseInt(i.value||'0',10);if(v>0)t+=v});totalQtyText.textContent=`총 수량: ${t}개`;}
addRowBtn.onclick=addRow;addRow();

async function submitOrder(){
  const company=document.getElementById('company').value.trim();
  const phone=document.getElementById('phone').value.trim();
  if(!company||!phone){showError('매장명과 연락처를 입력해주세요.');return;}
  const items=[];[...tbody.querySelectorAll('tr')].forEach(r=>{
    const base=r.children[0].querySelector('select').value;
    const custom=r.children[0].querySelector('input');
    const size=r.children[1].querySelector('select').value;
    const qty=parseInt(r.children[2].querySelector('input').value||'0',10);
    if(qty>0){items.push({item:base.includes('싱글 오리진')?(custom.value.trim()||'싱글 오리진'):base,size,qty});}
  });
  if(items.length===0){showError('최소 1개 이상 입력해주세요.');return;}
  submitBtn.disabled=true;submitBtn.textContent='제출 중...';
  const payload={company,phone,items};
  try{
    const res=await fetch(WEB_APP_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    const txt=await res.text();if(!res.ok){showError(`요청 실패 ${res.status}\\n${txt}`);return;}
    let data=null;try{data=JSON.parse(txt);}catch(_){}
    if(data&&data.ok){showSuccess(`주문 접수 완료! 주문번호: ${data.orderId}`);document.getElementById('company').value='';document.getElementById('phone').value='';tbody.innerHTML='';addRow();updateTotal();}
    else{showError(`응답 오류\\n${txt}`);}
  }catch(e){showError(`네트워크 오류: ${e.message}`);}finally{submitBtn.disabled=false;submitBtn.textContent='주문 제출';}
}
function showSuccess(t){document.getElementById('msg').innerHTML=`<div class='success'>${t}</div>`;}
function showError(t){document.getElementById('msg').innerHTML=`<div class='error'>${t}</div>`;}
submitBtn.onclick=submitOrder;
</script>
</body>
</html>

