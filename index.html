<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>[빈브라더스] 도매 파트너 주문서</title>
  <style>
    :root { --gap: 12px; --radius: 12px; --h: 44px; } /* 통일 높이 */
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Helvetica,Arial,sans-serif; margin:0; background:#fafafa; color:#111; }
    .container { max-width:720px; margin:24px auto; padding:24px; background:#fff; border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,.06); }
    h1 { margin:0 0 8px; font-size:22px }
    .top-notice { margin: 4px 0 18px; color:#444; font-size:14px; line-height:1.6; white-space:pre-line; }
    label { font-size:14px; color:#222; display:block; margin:16px 0 6px; font-weight:600 }
    .hint { color:#666; font-size:13px; margin-top:2px; }

    /* 통일 컨트롤 스타일 */
    .control {
      width:100%; height:var(--h);
      padding:0 14px; border:1px solid #ddd; border-radius:var(--radius);
      font-size:15px; line-height:var(--h); box-sizing:border-box; background:#fff;
    }
    select.control{ -webkit-appearance:none; appearance:none; padding-right:36px; }
    input.text-short { max-width:300px; width:100%; }

    /* 수량 입력 컨테이너 */
    .qty-container {
      display: flex;
      align-items: center;
      gap: 4px;
      width: 100%;
    }
    
    .qty-btn {
      width: 32px;
      height: var(--h);
      border: 1px solid #ddd;
      background: #f8f9fa;
      color: #495057;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      transition: all 0.15s ease;
    }
    
    .qty-btn:hover {
      background: #e9ecef;
      border-color: #adb5bd;
    }
    
    .qty-btn:active {
      background: #dee2e6;
    }
    
    .qty-btn.minus {
      border-radius: var(--radius) 0 0 var(--radius);
    }
    
    .qty-btn.plus {
      border-radius: 0 var(--radius) var(--radius) 0;
    }
    
    .qty-input {
      flex: 1;
      height: var(--h);
      border: 1px solid #ddd;
      border-left: none;
      border-right: none;
      text-align: center;
      font-size: 15px;
      background: #fff;
      min-width: 50px;
    }
    
    .qty-input:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
    }

    .table-wrap{ width:100%; overflow-x:auto; -webkit-overflow-scrolling:touch; }
    table{ width:100%; border-collapse:collapse; min-width:520px; table-layout:fixed; }
    th,td{ padding:10px; border-bottom:1px solid #eee; text-align:left; font-size:14px; vertical-align:middle }
    th{ background:#fafafa; font-weight:600 }

    /* 데스크탑: 3열 유지 (제품명/수량/삭제) */
    #itemsTable th:nth-child(1), #itemsTable td:nth-child(1){ width:58%; }
    #itemsTable th:nth-child(2), #itemsTable td:nth-child(2){ width:32%; }
    #itemsTable th:nth-child(3), #itemsTable td:nth-child(3){ width:10%;  text-align:center; }

    .btn{
      appearance:none; border:none; border-radius:var(--radius);
      height:var(--h); padding:0 14px; cursor:pointer; font-weight:700; font-size:15px; line-height:var(--h);
      display: inline-flex; align-items: center; justify-content: center;
    }
    .btn-primary{ background:#111; color:#fff }
    .btn-secondary{ background:#f1f3f5; color:#111 }
    .btn-danger{ 
      background:#ffe3e3; 
      color:#c92a2a;
      min-width: 60px;
      white-space: nowrap;
      overflow: hidden;
    }

    .row-actions{ display:flex; gap:var(--gap); align-items:center; justify-content:space-between; margin-top:14px }
    .success,.error{ padding:12px 14px;border-radius:var(--radius);margin-top:12px;font-size:14px;line-height:1.5 }
    .success{ background:#e6fcf5;color:#087f5b } .error{ background:#fff5f5;color:#c92a2a }

    /* 제품명 셀 내부 */
    .item-cell { display:flex; flex-direction:column; gap:6px; }
    .item-select { min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .item-custom { display:none; height:var(--h); }

    /* ✅ 모바일(≤640px): 카드형 전환으로 삭제 버튼 항상 보이게 */
    @media (max-width:640px){
      /* 테이블 헤더 숨기고 행을 카드처럼 2줄로 */
      #itemsTable thead{ display:none !important; }
      table#itemsTable{ min-width:0 !important; } /* 넘침 방지 */
      #itemsTable tr{
        display:grid !important;
        grid-template-columns: 1fr 80px; /* 우측 삭제 고정 */
        gap:8px 10px;
        grid-template-areas:
          "name del"
          "qty  qty";
        padding: 12px 0;
        border-bottom: 1px solid #eee;
      }
      #itemsTable td{ border-bottom:0; padding:0; }
      #itemsTable td:nth-child(1){ grid-area:name; }
      #itemsTable td:nth-child(2){ grid-area:qty; }
      #itemsTable td:nth-child(3){ grid-area:del; text-align:center; }

      /* 컨트롤 폭 */
      .item-cell .item-select,
      .item-cell .item-custom { width:100%; }

      /* 삭제 버튼 컴팩트 */
      .btn-danger{
        min-width:70px;
        padding:0 8px;
        height:var(--h);
        border-radius:var(--radius);
        white-space:nowrap;
        font-size: 14px;
      }
      
      /* 모바일에서 수량 컨테이너 조정 */
      .qty-container {
        max-width: 100px;
      }
      
      .qty-btn {
        width: 22px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>[빈브라더스] 도매 파트너 주문서</h1>

    <div class="top-notice">- 평일 오전 10시까지 주문시 당일 출고됩니다. 나머지 주문 건들은 익일 출고됩니다.
- 긴급 출고 요청 시, 카톡문의 혹은 전화 주세요. (010 8767 4709)</div>

    <!-- 1. 매장 이름 -->
    <label for="company">1) 매장 이름을 넣어주세요.</label>
    <input id="company" class="control text-short" placeholder="(예시) 빈브라더스 앨리웨이 인천점" />

    <!-- 2. 품목 -->
    <label>2) 주문하시는 품목을 입력해 주세요. <span class="hint">('+ 품목 추가'로 복수 입력 가능)</span></label>
    <div class="table-wrap">
      <table id="itemsTable">
        <thead>
          <tr><th>제품명</th><th>수량</th><th>삭제</th></tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div class="row-actions">
      <button type="button" id="addRow" class="btn btn-secondary">+ 품목 추가</button>
      <span id="totalQtyText">총 수량: 0개</span>
    </div>

    <!-- 3. 연락처 -->
    <label for="phone">3) 연락처를 남겨 주세요.</label>
    <input id="phone" class="control text-short" type="tel" inputmode="tel" placeholder="010-1234-5678" />

    <!-- 4. 추가요청사항 -->
    <label for="request">4) 추가요청사항이 있으시면 남겨주세요. <span class="hint">(선택사항)</span></label>
    <textarea id="request" class="control" rows="3" placeholder="긴급 배송 요청 등" style="height: auto; padding: 12px 14px; resize: vertical; line-height: 1.4;"></textarea>

    <div style="margin-top:12px">
      <button type="button" id="submitBtn" class="btn btn-primary">주문 제출</button>
    </div>

    <div id="msg"></div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const ITEMS = [
    "[원두] 블랙수트_1kg","[원두] 벨벳화이트_1kg","[원두] 세븐티_1kg",
    "[원두] 몰트_1kg","[원두] 매트_1kg",
    "[원두] 디카페인_ 미디엄로스트_1kg","[원두] 디카페인_ 다크 로스트_1kg",
    "[콜드브루] 블랙수트(고농도)_1L","[콜드브루] 블랙수트(중농도)_500ml",
    "[콜드브루] 디카페인(고농도)_1L","[콜드브루] 벨벳화이트(중농도)_500ml",
    "[콜드브루] 디카페인(중농도)_500ml","[콜드브루] 블랙수트 RTD_235ml",
    "[기타] 싱글 오리진_(제품명 변경)"
  ];
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzCyo0srQajtUb3ppy9Ka_aavCo3J25DknNls91GQ5hBNjkqrGnklawSYuLPMxRX7tTUg/exec";

  const tbody = document.getElementById('tbody');
  const submitBtn = document.getElementById('submitBtn');
  const totalQtyText = document.getElementById('totalQtyText');

  function makeSelect(list){
    const s=document.createElement('select');
    s.className = 'control item-select';
    list.forEach(v=>{const o=document.createElement('option');o.value=v;o.textContent=v;s.appendChild(o);});
    return s;
  }

  function createQtyContainer() {
    const container = document.createElement('div');
    container.className = 'qty-container';
    
    const minusBtn = document.createElement('button');
    minusBtn.type = 'button';
    minusBtn.className = 'qty-btn minus';
    minusBtn.textContent = '−';
    
    const input = document.createElement('input');
    input.type = 'text'; // number 대신 text로 변경
    input.value = '0';
    input.className = 'qty-input';
    input.inputMode = 'numeric'; // 모바일에서 숫자 키패드 표시
    input.pattern = '[0-9]*'; // 숫자만 허용 패턴
    
    const plusBtn = document.createElement('button');
    plusBtn.type = 'button';
    plusBtn.className = 'qty-btn plus';
    plusBtn.textContent = '+';
    
    // 숫자만 입력 허용
    input.addEventListener('input', (e) => {
      let value = e.target.value.replace(/[^0-9]/g, ''); // 숫자가 아닌 문자 제거
      if (value === '') value = '0';
      e.target.value = parseInt(value) || 0;
      updateTotal();
    });
    
    // 이벤트 리스너
    minusBtn.addEventListener('click', () => {
      const currentValue = parseInt(input.value) || 0;
      if (currentValue > 0) {
        input.value = currentValue - 1;
        updateTotal();
      }
    });
    
    plusBtn.addEventListener('click', () => {
      const currentValue = parseInt(input.value) || 0;
      input.value = currentValue + 1;
      updateTotal();
    });
    
    container.appendChild(minusBtn);
    container.appendChild(input);
    container.appendChild(plusBtn);
    
    return container;
  }

  function addRow(){
    const tr=document.createElement('tr');

    // 1) 제품명 (드롭다운 + 싱글오리진 커스텀 입력)
    const tdItem=document.createElement('td');
    tdItem.className='item-cell';
    const selItem=makeSelect(ITEMS);
    const custom=document.createElement('input');
    custom.type='text'; custom.placeholder='싱글 오리진 제품명'; custom.className='control item-custom';
    tdItem.append(selItem, custom);

    // 2) 수량 (개선된 +/- 버튼)
    const tdQty=document.createElement('td');
    const qtyContainer = createQtyContainer();
    tdQty.appendChild(qtyContainer);

    // 3) 삭제
    const tdDel=document.createElement('td');
    const del=document.createElement('button'); 
    del.textContent='삭제'; 
    del.className='btn btn-danger';
    tdDel.appendChild(del);

    tr.append(tdItem, tdQty, tdDel);
    tbody.appendChild(tr);

    function handleChange(){
      if(selItem.value.includes('싱글 오리진')) custom.style.display='block';
      else custom.style.display='none';
    }
    selItem.addEventListener('change', handleChange);
    handleChange();
    updateTotal();
  }

  function updateTotal(){
    let t=0;
    [...tbody.querySelectorAll('.qty-input')].forEach(i=>{
      const v=parseInt(i.value||'0',10); if(v>0) t+=v;
    });
    totalQtyText.textContent = `총 수량: ${t}개`;
  }

  // 이벤트 위임: 동적으로 추가된 버튼도 동작
  document.addEventListener('click', (e)=>{
    const add = e.target.closest('#addRow');
    if(add){ e.preventDefault(); addRow(); }
    const del = e.target.closest('.btn-danger');
    if(del){ e.preventDefault(); const tr=del.closest('tr'); if(tr) tr.remove(); updateTotal(); }
  });

  // 첫 행
  addRow();

  async function submitOrder(){
    const company=document.getElementById('company').value.trim();
    const phone=document.getElementById('phone').value.trim();
    const request=document.getElementById('request').value.trim();
    if(!company||!phone){showError('매장명과 연락처를 입력해주세요.');return;}

    const items=[];
    [...tbody.querySelectorAll('tr')].forEach(r=>{
      const base=r.children[0].querySelector('select').value;
      const custom=r.children[0].querySelector('.item-custom');
      const qty=parseInt(r.children[1].querySelector('.qty-input').value||'0',10);
      if(qty>0){
        const name=base.includes('싱글 오리진')?(custom.value.trim()||'싱글 오리진'):base;
        items.push({item:name, qty});
      }
    });
    if(items.length===0){showError('최소 1개 이상 입력해주세요.');return;}

    submitBtn.disabled=true; submitBtn.textContent='주문 제출 중...';

    // Form 방식으로 전송 (CORS 우회)
    try {
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = WEB_APP_URL;
      form.target = '_blank'; // 새 창에서 열기
      
      const input = document.createElement('input');
      input.type = 'hidden';
      input.name = 'data';
      input.value = JSON.stringify({company, phone, request, items});
      
      form.appendChild(input);
      document.body.appendChild(form);
      form.submit();
      document.body.removeChild(form);
      
      showSuccess(`주문이 제출되었습니다! 새 창에서 결과를 확인하세요.`);
      document.getElementById('company').value=''; 
      document.getElementById('phone').value='';
      document.getElementById('request').value='';
      tbody.innerHTML=''; 
      addRow(); 
      updateTotal();
      
    } catch(e) {
      showError(`오류 발생: ${e.message}`);
    } finally {
      submitBtn.disabled=false; 
      submitBtn.textContent='주문 제출';
    }
  }

  function showSuccess(t){document.getElementById('msg').innerHTML=`<div class='success'>${t}</div>`;}
  function showError(t){document.getElementById('msg').innerHTML=`<div class='error'>${t}</div>`;}
  
  // 전화번호 실시간 검증
  document.getElementById('phone').addEventListener('blur', function() {
    const phone = this.value.trim();
    if(phone && !validatePhone(phone)) {
      showError('올바른 전화번호를 입력해주세요. (예: 010-1234-5678)');
      this.style.borderColor = '#c92a2a';
    } else {
      document.getElementById('msg').innerHTML = '';
      this.style.borderColor = '#ddd';
    }
  });
  
  // 입력 시 테두리 색상 초기화
  document.getElementById('phone').addEventListener('input', function() {
    this.style.borderColor = '#ddd';
    document.getElementById('msg').innerHTML = '';
  });
  
  document.getElementById('submitBtn').addEventListener('click', submitOrder);
});
</script>
</body>
</html>
