<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>[ë¹ˆë¸Œë¼ë”ìŠ¤] ë„ë§¤ íŒŒíŠ¸ë„ˆ ì£¼ë¬¸ì„œ</title>
  <style>
    :root { --gap: 12px; --radius: 12px; --h: 44px; }
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Helvetica,Arial,sans-serif; margin:0; background:#fafafa; color:#111; }
    .container { max-width:720px; margin:24px auto; padding:24px; background:#fff; border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,.06); }
    h1 { margin:0 0 8px; font-size:22px }
    .top-notice { margin: 4px 0 18px; color:#444; font-size:14px; line-height:1.6; white-space:pre-line; }
    label { font-size:14px; color:#222; display:block; margin:16px 0 6px; font-weight:600 }
    .hint { color:#666; font-size:13px; margin-top:2px; }

    /* ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ */
    .category-section {
      margin: 24px 0;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 12px;
      border: 1px solid #e9ecef;
    }
    .category-title {
      font-size: 16px;
      font-weight: 700;
      color: #111;
      margin: 0 0 12px 0;
      padding-bottom: 8px;
      border-bottom: 2px solid #dee2e6;
    }

    /* í†µì¼ ì»¨íŠ¸ë¡¤ ìŠ¤íƒ€ì¼ */
    .control {
      width:100%; height:var(--h);
      padding:0 14px; border:1px solid #ddd; border-radius:var(--radius);
      font-size:15px; line-height:var(--h); box-sizing:border-box; background:#fff;
    }
    select.control{ -webkit-appearance:none; appearance:none; padding-right:36px; }
    input.text-short { max-width:300px; width:100%; }

    /* ìˆ˜ëŸ‰ ì…ë ¥ ì»¨í…Œì´ë„ˆ */
    .qty-container {
      display: flex;
      align-items: center;
      gap: 4px;
      width: 100%;
    }
    
    .qty-btn {
      width: 32px;
      height: var(--h);
      border: 1px solid #ddd;
      background: #f8f9fa;
      color: #495057;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      transition: all 0.15s ease;
    }
    
    .qty-btn:hover {
      background: #e9ecef;
      border-color: #adb5bd;
    }
    
    .qty-btn:active {
      background: #dee2e6;
    }
    
    .qty-btn.minus {
      border-radius: var(--radius) 0 0 var(--radius);
    }
    
    .qty-btn.plus {
      border-radius: 0 var(--radius) var(--radius) 0;
    }
    
    .qty-input {
      flex: 1;
      height: var(--h);
      border: 1px solid #ddd;
      border-left: none;
      border-right: none;
      text-align: center;
      font-size: 15px;
      background: #fff;
      min-width: 50px;
    }
    
    .qty-input:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
    }

    .table-wrap{ width:100%; overflow-x:auto; -webkit-overflow-scrolling:touch; }
    table{ width:100%; border-collapse:collapse; min-width:520px; table-layout:fixed; }
    th,td{ padding:10px; border-bottom:1px solid #eee; text-align:left; font-size:14px; vertical-align:middle }
    th{ background:#fff; font-weight:600 }

    table th:nth-child(1), table td:nth-child(1){ width:58%; }
    table th:nth-child(2), table td:nth-child(2){ width:32%; }
    table th:nth-child(3), table td:nth-child(3){ width:10%;  text-align:center; }

    .btn{
      appearance:none; border:none; border-radius:var(--radius);
      height:var(--h); padding:0 14px; cursor:pointer; font-weight:700; font-size:15px; line-height:var(--h);
      display: inline-flex; align-items: center; justify-content: center;
    }
    .btn-primary{ background:#111; color:#fff }
    .btn-secondary{ background:#fff; color:#111; border: 1px solid #ddd; }
    .btn-danger{ 
      background:#ffe3e3; 
      color:#c92a2a;
      min-width: 60px;
      white-space: nowrap;
      overflow: hidden;
    }

    .row-actions{ display:flex; gap:var(--gap); align-items:center; justify-content:space-between; margin-top:14px }
    .category-qty { font-size: 14px; color: #666; font-weight: 600; }
    
    .total-summary {
      margin: 24px 0;
      padding: 16px 20px;
      background: #111;
      color: #fff;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 700;
      text-align: center;
    }
    
    .success,.error{ padding:12px 14px;border-radius:var(--radius);margin-top:12px;font-size:14px;line-height:1.5 }
    .success{ background:#e6fcf5;color:#087f5b } .error{ background:#fff5f5;color:#c92a2a }

    /* í”Œë¡œíŒ… ì œì¶œ ë²„íŠ¼ */
    .floating-submit {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      padding: 12px 16px;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
      z-index: 1000;
      display: flex;
      justify-content: center;
      gap: 12px;
      align-items: center;
    }
    
    .floating-submit .btn-primary {
      flex: 1;
      max-width: 400px;
    }
    
    .floating-total {
      font-size: 15px;
      font-weight: 700;
      color: #111;
      white-space: nowrap;
    }
    
    /* í”Œë¡œíŒ… ë²„íŠ¼ ê³µê°„ í™•ë³´ */
    body {
      padding-bottom: 80px;
    }

    .item-cell { display:flex; flex-direction:column; gap:6px; }
    .item-select { min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .item-custom { display:none; height:var(--h); }

    @media (max-width:640px){
      .category-section { padding: 16px; }
      
      /* í”Œë¡œíŒ… ë²„íŠ¼ ëª¨ë°”ì¼ ìµœì í™” */
      .floating-submit {
        padding: 10px 12px;
      }
      
      .floating-total {
        font-size: 14px;
      }
      
      body {
        padding-bottom: 70px;
      }
      
      table thead{ display:none !important; }
      table{ min-width:0 !important; }
      table tr{
        display:grid !important;
        grid-template-columns: 1fr 60px;
        gap:8px 10px;
        grid-template-areas:
          "name del"
          "qty  qty";
        padding: 12px 0;
        border-bottom: 1px solid #eee;
      }
      table td{ border-bottom:0; padding:0; }
      table td:nth-child(1){ grid-area:name; }
      table td:nth-child(2){ grid-area:qty; }
      table td:nth-child(3){ grid-area:del; text-align:center; }

      .item-cell .item-select,
      .item-cell .item-custom { width:100%; }

      .btn-danger{
        min-width:60px;
        padding:0 6px;
        height:var(--h);
        border-radius:var(--radius);
        white-space:nowrap;
        font-size: 13px;
      }
      
      .qty-container {
        max-width: 80px;
      }
      
      .qty-btn {
        width: 20px;
        font-size: 13px;
      }
      
      .qty-input {
        min-width: 40px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>[ë¹ˆë¸Œë¼ë”ìŠ¤] ë„ë§¤ íŒŒíŠ¸ë„ˆ ì£¼ë¬¸ì„œ</h1>

    <div class="top-notice">- í‰ì¼ ì˜¤ì „ 10ì‹œê¹Œì§€ ì£¼ë¬¸ì‹œ ë‹¹ì¼ ì¶œê³ ë©ë‹ˆë‹¤. ë‚˜ë¨¸ì§€ ì£¼ë¬¸ ê±´ë“¤ì€ ìµì¼ ì¶œê³ ë©ë‹ˆë‹¤.
- ê¸´ê¸‰ ì¶œê³  ìš”ì²­ ì‹œ, ì¹´í†¡ë¬¸ì˜ í˜¹ì€ ì „í™” ì£¼ì„¸ìš”. (010 8767 4709)</div>

    <!-- 1. ë§¤ì¥ ì´ë¦„ -->
    <label for="company">1) ë§¤ì¥ ì´ë¦„ì„ ë„£ì–´ì£¼ì„¸ìš”.</label>
    <input id="company" class="control text-short" placeholder="(ì˜ˆì‹œ) ë¹ˆë¸Œë¼ë”ìŠ¤ ì•¨ë¦¬ì›¨ì´ ì¸ì²œì " />

    <!-- 2. ì—°ë½ì²˜ -->
    <label for="phone">2) ì—°ë½ì²˜ë¥¼ ë‚¨ê²¨ ì£¼ì„¸ìš”.</label>
    <input id="phone" class="control text-short" type="tel" inputmode="tel" placeholder="010-1234-5678" />

    <!-- 3. í’ˆëª© -->
    <label>3) ì£¼ë¬¸í•˜ì‹œëŠ” í’ˆëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.</label>

    <!-- ì¹´í…Œê³ ë¦¬ 1: ì œì¡°ìš© ì›ë‘/ì½œë“œë¸Œë£¨ -->
    <div class="category-section">
      <div class="category-title">ì œì¡°ìš© ì›ë‘ / ì½œë“œë¸Œë£¨</div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>ì œí’ˆëª…</th><th>ìˆ˜ëŸ‰</th><th>ì‚­ì œ</th></tr>
          </thead>
          <tbody id="tbody-beans"></tbody>
        </table>
      </div>
      <div class="row-actions">
        <button type="button" class="btn btn-secondary add-row-btn" data-category="beans">+ í’ˆëª© ì¶”ê°€</button>
        <span class="category-qty" id="qty-beans">ìˆ˜ëŸ‰: 0ê°œ</span>
      </div>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ 2: ë“œë¦½ë°±/ìº¡ìŠ -->
    <div class="category-section">
      <div class="category-title">ë“œë¦½ë°± / ìº¡ìŠ</div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>ì œí’ˆëª…</th><th>ìˆ˜ëŸ‰</th><th>ì‚­ì œ</th></tr>
          </thead>
          <tbody id="tbody-drip"></tbody>
        </table>
      </div>
      <div class="row-actions">
        <button type="button" class="btn btn-secondary add-row-btn" data-category="drip">+ í’ˆëª© ì¶”ê°€</button>
        <span class="category-qty" id="qty-drip">ìˆ˜ëŸ‰: 0ê°œ</span>
      </div>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ 3: ì¢…ì´ì»µ -->
    <div class="category-section">
      <div class="category-title">ì¢…ì´ì»µ</div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>ì œí’ˆëª…</th><th>ìˆ˜ëŸ‰</th><th>ì‚­ì œ</th></tr>
          </thead>
          <tbody id="tbody-cup"></tbody>
        </table>
      </div>
      <div class="row-actions">
        <button type="button" class="btn btn-secondary add-row-btn" data-category="cup">+ í’ˆëª© ì¶”ê°€</button>
        <span class="category-qty" id="qty-cup">ìˆ˜ëŸ‰: 0ê°œ</span>
      </div>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ 4: ê¸°íƒ€ -->
    <div class="category-section">
      <div class="category-title">ê¸°íƒ€</div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>ì œí’ˆëª…</th><th>ìˆ˜ëŸ‰</th><th>ì‚­ì œ</th></tr>
          </thead>
          <tbody id="tbody-etc"></tbody>
        </table>
      </div>
      <div class="row-actions">
        <button type="button" class="btn btn-secondary add-row-btn" data-category="etc">+ í’ˆëª© ì¶”ê°€</button>
        <span class="category-qty" id="qty-etc">ìˆ˜ëŸ‰: 0ê°œ</span>
      </div>
    </div>

    <!-- ì´ ìˆ˜ëŸ‰ -->
    <div class="total-summary" id="totalQtyText">ì´ ìˆ˜ëŸ‰: 0ê°œ</div>

    <!-- 4. ì¶”ê°€ìš”ì²­ì‚¬í•­ -->
    <label for="request">4) ì¶”ê°€ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ë©´ ë‚¨ê²¨ì£¼ì„¸ìš”. <span class="hint">(ì„ íƒ)</span></label>
    <textarea id="request" class="control" rows="3" placeholder="ê¸´ê¸‰ ë°°ì†¡ ìš”ì²­ ë“±" style="height: auto; padding: 12px 14px; resize: vertical; line-height: 1.4;"></textarea>

    <div id="msg"></div>
  </div>

  <!-- í”Œë¡œíŒ… ì œì¶œ ë²„íŠ¼ -->
  <div class="floating-submit">
    <span class="floating-total" id="floatingTotal">ì´ 0ê°œ</span>
    <button type="button" id="floatingSubmitBtn" class="btn btn-primary">ì£¼ë¬¸ ì œì¶œ</button>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // ì¹´í…Œê³ ë¦¬ë³„ ì œí’ˆ ëª©ë¡
  const PRODUCTS = {
    beans: [
      "[ì›ë‘] ë¸”ë™ìˆ˜íŠ¸_1kg",
      "[ì›ë‘] ë²¨ë²³í™”ì´íŠ¸_1kg",
      "[ì›ë‘] ì„¸ë¸í‹°_1kg",
      "[ì›ë‘] ëª°íŠ¸_1kg",
      "[ì›ë‘] ë§¤íŠ¸_1kg",
      "[ì›ë‘] ë””ì¹´í˜ì¸_ ë¯¸ë””ì—„ë¡œìŠ¤íŠ¸_1kg",
      "[ì›ë‘] ë””ì¹´í˜ì¸_ ë‹¤í¬ ë¡œìŠ¤íŠ¸_1kg",
      "[ì½œë“œë¸Œë£¨] ë¸”ë™ìˆ˜íŠ¸(ê³ ë†ë„)_1L",
      "[ì½œë“œë¸Œë£¨] ë¸”ë™ìˆ˜íŠ¸(ì¤‘ë†ë„)_500ml",
      "[ì½œë“œë¸Œë£¨] ë””ì¹´í˜ì¸(ê³ ë†ë„)_1L",
      "[ì½œë“œë¸Œë£¨] ë²¨ë²³í™”ì´íŠ¸(ì¤‘ë†ë„)_500ml",
      "[ì½œë“œë¸Œë£¨] ë””ì¹´í˜ì¸(ì¤‘ë†ë„)_500ml",
      "[ì½œë“œë¸Œë£¨] ë¸”ë™ìˆ˜íŠ¸ RTD_235ml",
      "[ì›ë‘] ë¸”ë™ìˆ˜íŠ¸ 200g"
    ],
    drip: [
      "[ë“œë¦½ë°±] ë¸”ë™ìˆ˜íŠ¸ 8ê°œì…",
      "[ë“œë¦½ë°±] ë²¨ë²³í™”ì´íŠ¸ 8ê°œì…",
      "[ë“œë¦½ë°±] ë””ì¹´í˜ì¸ 8ê°œì…",
      "[ë“œë¦½ë°±] ë¸”ë™ìˆ˜íŠ¸ & ë²¨ë²³í™”ì´íŠ¸ 20ê°œì…",
      "[ë“œë¦½ë°±] ë¸”ë Œë“œ & ì‹±ê¸€ 20ê°œì…",
      "[ë“œë¦½ë°±] ë””ìŠ¤ì»¤ë²„ë¦¬ ì„¸íŠ¸ 16ê°œì…",
      "[ìº¡ìŠ] ë¸”ë™ìˆ˜íŠ¸ 10ê°œì…",
      "[ìº¡ìŠ] ë²¨ë²³í™”ì´íŠ¸ 10ê°œì…",
      "[ìº¡ìŠ] ë””ì¹´í˜ì¸ 10ê°œì…",
      "ì‡¼í•‘ë°± (ì†Œ)"
    ],
    cup: [
      "ì´ì¤‘ì»µ 10oz_(1box/500ea)",
      "ì´ì¤‘ì»µ 13oz_(1box/500ea)",
      "ì´ì¤‘ì»µ 16oz_(1box/500ea)",
      "[ë¦¬ë“œ] ì•„ì´ìŠ¤ ë¦¬ë“œ 10/13oz_(1box/1000ea)",
      "[ë¦¬ë“œ] ì•„ì´ìŠ¤ ë¦¬ë“œ 16oz_(1box/1000ea)",
      "[ë¦¬ë“œ] í•« ë¦¬ë“œ 10/13oz_(1box/1000ea)"
    ],
    etc: [
      "[ê¸°íƒ€] ì œí’ˆëª… ì…ë ¥ (ì‹±ê¸€ ì˜¤ë¦¬ì§„ ë“±)"
    ]
  };

  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzYtmwo0BbBdouvMiQwlkp9dtAL5p0dIb2RIKDyQFn0pUtmugX3QJbGTugaKtk-Y_wTRQ/exec";

  const totalQtyText = document.getElementById('totalQtyText');
  
  // ğŸ”’ ì œì¶œ ì¤‘ í”Œë˜ê·¸
  let isSubmitting = false;

  function makeSelect(list){
    const s=document.createElement('select');
    s.className = 'control item-select';
    list.forEach(v=>{const o=document.createElement('option');o.value=v;o.textContent=v;s.appendChild(o);});
    return s;
  }

  function createQtyContainer() {
    const container = document.createElement('div');
    container.className = 'qty-container';
    
    const minusBtn = document.createElement('button');
    minusBtn.type = 'button';
    minusBtn.className = 'qty-btn minus';
    minusBtn.textContent = 'âˆ’';
    
    const input = document.createElement('input');
    input.type = 'text';
    input.value = '0';
    input.className = 'qty-input';
    input.inputMode = 'numeric';
    input.pattern = '[0-9]*';
    
    const plusBtn = document.createElement('button');
    plusBtn.type = 'button';
    plusBtn.className = 'qty-btn plus';
    plusBtn.textContent = '+';
    
    input.addEventListener('input', (e) => {
      let value = e.target.value.replace(/[^0-9]/g, '');
      if (value === '') value = '0';
      e.target.value = parseInt(value) || 0;
      updateTotal();
    });
    
    minusBtn.addEventListener('click', () => {
      const currentValue = parseInt(input.value) || 0;
      if (currentValue > 0) {
        input.value = currentValue - 1;
        updateTotal();
      }
    });
    
    plusBtn.addEventListener('click', () => {
      const currentValue = parseInt(input.value) || 0;
      input.value = currentValue + 1;
      updateTotal();
    });
    
    container.appendChild(minusBtn);
    container.appendChild(input);
    container.appendChild(plusBtn);
    
    return container;
  }

  function addRow(category){
    const tbody = document.getElementById(`tbody-${category}`);
    const tr = document.createElement('tr');

    // 1) ì œí’ˆëª…
    const tdItem = document.createElement('td');
    tdItem.className = 'item-cell';
    const selItem = makeSelect(PRODUCTS[category]);
    const custom = document.createElement('input');
    custom.type = 'text'; 
    custom.placeholder = 'ì œí’ˆëª… ì§ì ‘ ì…ë ¥'; 
    custom.className = 'control item-custom';
    tdItem.append(selItem, custom);

    // 2) ìˆ˜ëŸ‰
    const tdQty = document.createElement('td');
    const qtyContainer = createQtyContainer();
    tdQty.appendChild(qtyContainer);

    // 3) ì‚­ì œ
    const tdDel = document.createElement('td');
    const del = document.createElement('button'); 
    del.textContent = 'ì‚­ì œ'; 
    del.className = 'btn btn-danger';
    tdDel.appendChild(del);

    tr.append(tdItem, tdQty, tdDel);
    tbody.appendChild(tr);

    function handleChange(){
      if(selItem.value.includes('ì œí’ˆëª… ì…ë ¥') || selItem.value.includes('ì‹±ê¸€ ì˜¤ë¦¬ì§„')) {
        custom.style.display = 'block';
      } else {
        custom.style.display = 'none';
      }
    }
    selItem.addEventListener('change', handleChange);
    handleChange();
    updateTotal();
  }

  function updateTotal(){
    let totalAll = 0;
    
    // ê° ì¹´í…Œê³ ë¦¬ë³„ ìˆ˜ëŸ‰ ê³„ì‚°
    ['beans', 'drip', 'cup', 'etc'].forEach(cat => {
      const tbody = document.getElementById(`tbody-${cat}`);
      let catTotal = 0;
      [...tbody.querySelectorAll('.qty-input')].forEach(i => {
        const v = parseInt(i.value || '0', 10);
        if (v > 0) catTotal += v;
      });
      document.getElementById(`qty-${cat}`).textContent = `ìˆ˜ëŸ‰: ${catTotal}ê°œ`;
      totalAll += catTotal;
    });
    
    totalQtyText.textContent = `ì´ ìˆ˜ëŸ‰: ${totalAll}ê°œ`;
    document.getElementById('floatingTotal').textContent = `ì´ ${totalAll}ê°œ`;
  }

  // ì´ë²¤íŠ¸ ìœ„ì„
  document.addEventListener('click', (e) => {
    const addBtn = e.target.closest('.add-row-btn');
    if(addBtn){ 
      e.preventDefault(); 
      const category = addBtn.getAttribute('data-category');
      addRow(category); 
    }
    
    const delBtn = e.target.closest('.btn-danger');
    if(delBtn){ 
      e.preventDefault(); 
      const tr = delBtn.closest('tr'); 
      if(tr) tr.remove(); 
      updateTotal(); 
    }
  });

  // ê° ì¹´í…Œê³ ë¦¬ ì²« í–‰ ì¶”ê°€
  ['beans', 'drip', 'cup', 'etc'].forEach(cat => addRow(cat));

  // ğŸ”’ ì£¼ë¬¸ ê³ ìœ  ID ìƒì„±
  function generateOrderHash(company, phone, items) {
    const itemsText = items.map(it => `${it.item}:${it.qty}`).join('|');
    const combined = `${company}|${phone}|${itemsText}`;
    // ê°„ë‹¨í•œ í•´ì‹œ (ì‹¤ì œë¡œëŠ” ë” ë³µì¡í•œ í•´ì‹œ í•¨ìˆ˜ ì‚¬ìš© ê°€ëŠ¥)
    const utf8 = new TextEncoder().encode(combined);
    let binary = '';
    utf8.forEach(b => binary += String.fromCharCode(b));
    return btoa(binary).substring(0, 32);
  }

  async function submitOrder(){
    // ğŸ”’ ì´ë¯¸ ì œì¶œ ì¤‘ì´ë©´ ì¤‘ë‹¨
    if(isSubmitting) {
      console.log('ì´ë¯¸ ì œì¶œ ì¤‘ì…ë‹ˆë‹¤');
      return;
    }
    
    const company = document.getElementById('company').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const request = document.getElementById('request').value.trim();
    
    if(!company || !phone){
      showError('ë§¤ì¥ëª…ê³¼ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    const items = [];
    
    // ëª¨ë“  ì¹´í…Œê³ ë¦¬ì˜ ì•„ì´í…œ ìˆ˜ì§‘
    ['beans', 'drip', 'cup', 'etc'].forEach(cat => {
      const tbody = document.getElementById(`tbody-${cat}`);
      [...tbody.querySelectorAll('tr')].forEach(r => {
        const base = r.children[0].querySelector('select').value;
        const custom = r.children[0].querySelector('.item-custom');
        const qty = parseInt(r.children[1].querySelector('.qty-input').value || '0', 10);
        
        if(qty > 0){
          let name = base;
          if(base.includes('ì œí’ˆëª… ì…ë ¥') || base.includes('ì‹±ê¸€ ì˜¤ë¦¬ì§„')){
            name = custom.value.trim() || base;
          }
          items.push({item: name, qty: qty});
        }
      });
    });
    
    if(items.length === 0){
      showError('ìµœì†Œ 1ê°œ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    // ğŸ”’ ì¤‘ë³µ ì œì¶œ ë°©ì§€: localStorage í™•ì¸
    const orderHash = generateOrderHash(company, phone, items);
    const lastSubmit = localStorage.getItem('lastOrderSubmit');
    
    if(lastSubmit){
      try {
        const lastData = JSON.parse(lastSubmit);
        const hoursSince = (Date.now() - lastData.timestamp) / (1000 * 60 * 60);
        
        // 24ì‹œê°„ ì´ë‚´ ë™ì¼ ì£¼ë¬¸
        if(hoursSince < 24 && lastData.hash === orderHash){
          const hoursAgo = Math.floor(hoursSince);
          if(!confirm(`${hoursAgo}ì‹œê°„ ì „ì— ë™ì¼í•œ ì£¼ë¬¸ì„ í•˜ì…¨ìŠµë‹ˆë‹¤.\në‹¤ì‹œ ì£¼ë¬¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){
            return;
          }
        }
      } catch(e) {
        console.error('localStorage íŒŒì‹± ì˜¤ë¥˜:', e);
      }
    }

    // ğŸ”’ ì œì¶œ ì‹œì‘
    isSubmitting = true;
    const floatingBtn = document.getElementById('floatingSubmitBtn');
    floatingBtn.disabled = true;
    floatingBtn.textContent = 'ì œì¶œ ì¤‘...';

    try {
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = WEB_APP_URL;
      form.target = '_blank';
      
      const input = document.createElement('input');
      input.type = 'hidden';
      input.name = 'data';
      input.value = JSON.stringify({company, phone, request, items});
      
      form.appendChild(input);
      document.body.appendChild(form);
      form.submit();
      document.body.removeChild(form);
      
      // ğŸ”’ ì œì¶œ ì„±ê³µ - localStorageì— ê¸°ë¡
      localStorage.setItem('lastOrderSubmit', JSON.stringify({
        hash: orderHash,
        timestamp: Date.now(),
        company: company,
        phone: phone
      }));
      
      showSuccess(`ì£¼ë¬¸ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤! ìƒˆ ì°½ì—ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
      
      // í¼ ì´ˆê¸°í™”
      document.getElementById('company').value = ''; 
      document.getElementById('phone').value = '';
      document.getElementById('request').value = '';
      
      ['beans', 'drip', 'cup', 'etc'].forEach(cat => {
        document.getElementById(`tbody-${cat}`).innerHTML = '';
        addRow(cat);
      });
      
      updateTotal();
      
    } catch(e) {
      showError(`ì˜¤ë¥˜ ë°œìƒ: ${e.message}`);
    } finally {
      // ğŸ”’ ì œì¶œ ì™„ë£Œ
      isSubmitting = false;
      floatingBtn.disabled = false;
      floatingBtn.textContent = 'ì£¼ë¬¸ ì œì¶œ';
    }
  }

  function showSuccess(t){document.getElementById('msg').innerHTML=`<div class='success'>${t}</div>`;}
  function showError(t){document.getElementById('msg').innerHTML=`<div class='error'>${t}</div>`;}
  
  document.getElementById('phone').addEventListener('blur', function() {
    const phone = this.value.trim();
    if(phone && !/^01[0-9]-?[0-9]{3,4}-?[0-9]{4}$/.test(phone)) {
      showError('ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 010-1234-5678)');
      this.style.borderColor = '#c92a2a';
    } else {
      document.getElementById('msg').innerHTML = '';
      this.style.borderColor = '#ddd';
    }
  });
  
  document.getElementById('phone').addEventListener('input', function() {
    this.style.borderColor = '#ddd';
    document.getElementById('msg').innerHTML = '';
  });
  
  document.getElementById('floatingSubmitBtn').addEventListener('click', submitOrder);
});
</script>
</body>
</html>
